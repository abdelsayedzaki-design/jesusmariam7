<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø¯Ù…Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ - Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-body: #0f172a;
            --bg-section: #1e293b;
            --text-main: white;
            --border-color: #334155;
            --input-bg: #0f172a;
            --primary: #6366f1;
            --accent: #fbbf24;
            --success: #10b981;
        }

        [data-theme="light"] {
            --bg-body: #f1f5f9;
            --bg-section: #ffffff;
            --text-main: #1e293b;
            --border-color: #cbd5e1;
            --input-bg: #f8fafc;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-body); color: var(--text-main); margin: 0; padding: 10px; transition: 0.3s; }
        .verse-container { background: linear-gradient(135deg, #312e81 0%, #4338ca 100%); padding: 20px; border-radius: 20px; margin-bottom: 20px; text-align: center; border: 2px solid #6366f1; box-shadow: 0 10px 20px rgba(0,0,0,0.3); position: relative; overflow: hidden; }
        .verse-text { font-size: 18px; font-weight: bold; color: #fef3c7; line-height: 1.6; margin-bottom: 8px; }
        .verse-ref { font-size: 14px; color: #c7d2fe; font-style: italic; }
        #loginScreen { position: fixed; inset: 0; background: #0f172a; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .login-box { background: #1e293b; padding: 30px; border-radius: 20px; text-align: center; border: 2px solid #6366f1; width: 85%; max-width: 350px; }
        #mainContent { display: none; }
        #adminAlert { display: none; background: #b91c1c; color: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 2px solid #ef4444; animation: flash 2s infinite; }
        @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .main-title { text-align: center; color: #818cf8; margin-bottom: 20px; }
        .section { background: var(--bg-section); padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid var(--border-color); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(85px, 1fr)); gap: 10px; }
        .card { background: #0f172a; padding: 10px; border-radius: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.1); }
        .bar-wrap { height: 60px; background: #334155; border-radius: 5px; overflow: hidden; margin: 5px 0; display: flex; align-items: flex-end; }
        .bar { width: 100%; transition: height 1s; }
        .bg-high { background: linear-gradient(to top, #16a34a, #4ade80); }
        .bg-mid { background: linear-gradient(to top, #ca8a04, #facc15); }
        .bg-low { background: linear-gradient(to top, #dc2626, #f87171); }
        
        textarea, input[type="text"], input[type="password"], select, input[type="number"] { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-main); box-sizing: border-box; margin-bottom: 10px; outline: none; }
        .btn { background: #6366f1; color: white; padding: 12px; width: 100%; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        
        .quiz-card { border: 2px solid var(--accent); position: relative; }
        .question-card { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; margin-bottom: 15px; border-right: 4px solid var(--primary); }
        .option-label { display: block; background: var(--bg-body); padding: 10px; margin: 5px 0; border-radius: 8px; cursor: pointer; border: 1px solid var(--border-color); font-size: 14px; }
        #quizTimerDisplay { font-size: 18px; font-weight: bold; color: #ef4444; text-align: center; margin-bottom: 15px; padding: 10px; border: 1px solid #ef4444; border-radius: 10px; background: rgba(239, 68, 68, 0.1); }

        .chat-display { height: 180px; overflow-y: auto; background: var(--input-bg); padding: 10px; border-radius: 10px; margin-bottom: 10px; }
        .chat-msg { background: var(--bg-section); padding: 8px 10px; border-radius: 10px; margin-bottom: 6px; font-size: 13px; border-right: 3px solid #6366f1; word-wrap: break-word; color: var(--text-main); }
        .switch-container { display: flex; justify-content: space-between; align-items: center; background: #334155; padding: 10px 15px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #ec4899; color: white; }
        .switch { position: relative; display: inline-block; width: 44px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #1e293b; transition: .4s; border-radius: 34px; border: 1px solid #475569; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 4px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ec4899; }
        input:checked + .slider:before { transform: translateX(22px); }
        .mood-container { display: flex; justify-content: space-around; margin: 15px 0; }
        .mood-btn { font-size: 28px; cursor: pointer; transition: 0.2s; opacity: 0.5; }
        .mood-btn.active { opacity: 1; transform: scale(1.2); border-bottom: 2px solid #ec4899; }
        #prayerTimer { display: none; background: #312e81; padding: 15px; border-radius: 15px; border: 2px solid #818cf8; margin-top: 15px; text-align: center; }
        .prayer-counter { font-size: 45px; font-weight: bold; color: #fbbf24; margin: 5px 0; }
        .prayer-text-display { font-size: 17px; font-weight: bold; color: #fef3c7; min-height: 60px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px; text-align: center; }
        
        .theme-toggle-btn { position: absolute; top: 10px; left: 10px; background: rgba(99, 102, 241, 0.2); border: 1px solid #6366f1; color: var(--text-main); padding: 5px 10px; border-radius: 10px; font-size: 12px; cursor: pointer; z-index: 10; }
        .lib-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .lib-card { background: #064e3b; border: 2px solid #10b981; padding: 15px; border-radius: 12px; text-align: center; cursor: pointer; text-decoration: none; color: white; font-weight: bold; font-size: 14px; }

        .clear-chat-btn {
            background: #dc2626; 
            color: white;
            border: none;
            border-radius: 5px;
            padding: 4px 10px;
            font-size: 11px;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 5px;
        }
        .clear-chat-btn:hover { background: #b91c1c; }

        .prayer-altar-switch { border: 1px solid #fbbf24 !important; }
        .prayer-altar-switch input:checked + .slider { background-color: #fbbf24 !important; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ø¨Ù†Ø¯ Ø§Ù„Ù…ÙŠØ·Ø§Ù†ÙŠØ© */
        .metania-row { display: flex; align-items: center; gap: 10px; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 10px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.1); }
        .metania-row input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .metania-row input[type="number"] { margin-bottom: 0; width: 80px; padding: 5px; text-align: center; }
    </style>
</head>
<body>

    <div id="loginScreen">
        <div class="login-box">
            <h3 style="margin:0 0 10px 0; color:#818cf8;">â€  Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† â€ </h3>
            <input type="password" id="passInputUser" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
            <button class="btn" onclick="checkAccess()">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="mainContent">
        <button class="theme-toggle-btn" onclick="toggleTheme()" id="themeBtn">â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­</button>

        <div class="main-title">
            <h2 style="margin:0;">Ø®Ø¯Ù…Ø© Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</h2>
            <small>ÙƒÙ†ÙŠØ³Ø© Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡ ÙˆØ£Ø¨ÙˆØ³ÙŠÙÙŠÙ† ÙˆØ§Ù„Ø´Ù‡ÙŠØ¯ Ø£Ø¨Ø³Ø®ÙŠØ±ÙˆÙ†</small>
        </div>

        <div class="verse-container">
            <div id="dailyVerse" class="verse-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¢ÙŠØ© ØªØ¹Ø²ÙŠØ©...</div>
            <div id="verseRef" class="verse-ref"></div>
        </div>

        <div id="adminAlert">
            <b style="display:block;">ğŸ“¢ ØªÙ†Ø¨ÙŠÙ‡ Ù…Ù† Ø§Ù„Ø®Ø¯Ø§Ù…:</b>
            <span id="alertText"></span>
        </div>

        <div id="quizSection" class="section quiz-card" style="display: none;">
            <h3 style="margin-top:0; color: var(--accent);">ğŸ“– Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ø³</h3>
            <div id="quizSetup">
                <p style="font-size: 13px;">Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ø¨Ø¯Ø¡:</p>
                <select id="userNameListQuiz">
                    <option value="">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡...</option>
                </select>
                <button class="btn" style="background: var(--accent); color: #000;" onclick="startQuiz()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø¢Ù† ğŸš€</button>
            </div>
            <div id="quizArea" style="display: none;">
                <div id="quizTimerDisplay">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="timeLeft">00:00</span></div>
                <div id="questionsContainer"></div>
                <button class="btn" style="background: var(--success);" onclick="submitQuiz()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª âœ…</button>
            </div>
            <div id="quizDone" style="display: none; text-align: center; padding: 10px;">
                <h3 id="quizStatusTitle" style="color: var(--success);">ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„!</h3>
                <div id="finalQuizScore" style="font-size: 20px; font-weight: bold; color: var(--accent); margin: 10px 0;"></div>
                <p style="font-size: 12px;">Ø¯Ø±Ø¬ØªÙƒ Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù â¤ï¸</p>
            </div>
        </div>

        <div class="section">
            <h3 style="margin-top:0; color: #fbbf24;">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ø±Ù</h3>
            <div id="leaderboard" class="grid"></div>
        </div>

        <div class="section">
            <h3>ğŸ“ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø©</h3>
            <input type="text" id="userName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." oninput="localStorage.setItem('chat_user_name', this.value)">
        </div>

        <div id="chatSection" class="section" style="border-right: 5px solid #6366f1;">
            <h3>ğŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</h3>
            <div id="chatBox" class="chat-display"></div>
            <div style="display:flex; gap:5px;">
                <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
                <button onclick="sendChat()" style="background:#6366f1; border:none; padding:0 15px; border-radius:10px; color:white;">Ø¥Ø±Ø³Ø§Ù„</button>
            </div>
        </div>

        <div class="switch-container">
            <span style="font-weight: bold;">ğŸŒ± Ø±ÙƒÙ† Ø§Ù„Ù…Ø³Ø§Ù†Ø¯Ø© Ø§Ù„Ù†ÙØ³ÙŠØ©</span>
            <label class="switch">
                <input type="checkbox" onchange="document.getElementById('psyArea').style.display = this.checked ? 'block' : 'none'">
                <span class="slider"></span>
            </label>
        </div>

        <div id="psyArea" class="section" style="display: none; border: 2px solid #ec4899;">
             <p style="text-align:center; font-size:13px;">Ù…Ø§ ØªØ®ÙØ´ Ø§Ø­Ù†Ø§ Ø¬Ù†Ø¨Ùƒ Ø¨Ù†Ø­Ø¨Ùƒ ÙˆØ§Ù†Øª ØºØ§Ù„ÙŠ Ø¹Ù„Ù‰ Ù‚Ù„Ø¨ Ø§Ù„Ù…Ø³ÙŠØ­.. â¤ï¸</p>
             <input type="text" id="psyNameInput" placeholder="Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±ØºØ§Ù‹ Ù„Ù„Ù…Ø¬Ù‡ÙˆÙ„)" style="border: 1px dashed #ec4899; font-size: 13px;">
             <div class="mood-container">
                <span class="mood-btn" onclick="setMood(this, 'ğŸ˜­')">ğŸ˜­</span>
                <span class="mood-btn" onclick="setMood(this, 'ğŸ˜¥')">ğŸ˜¥</span>
                <span class="mood-btn" onclick="setMood(this, 'ğŸ˜Ÿ')">ğŸ˜Ÿ</span>
                <span class="mood-btn" onclick="setMood(this, 'ğŸ˜Œ')">ğŸ˜Œ</span>
                <span class="mood-btn" onclick="setMood(this, 'ğŸ˜Š')">ğŸ˜Š</span>
             </div>
             <select id="psyNeed">
                <option value="Ù…Ø¬Ø±Ø¯ ÙØ¶ÙØ¶Ø© ğŸ—£ï¸">ğŸ—£ï¸ Ù…Ø¬Ø±Ø¯ ÙØ¶ÙØ¶Ø©</option>
                <option value="ØµÙ„Ø§Ø© Ù…Ù† Ø£Ø¬Ù„ÙŠ ğŸ™">ğŸ™ ØµÙ„Ø§Ø© Ù…Ù† Ø£Ø¬Ù„ÙŠ</option>
                <option value="Ø¥Ù†Ù‚Ø§Ø° Ø³Ø±ÙŠØ¹ ğŸš¨">ğŸš¨ Ø¥Ù†Ù‚Ø§Ø° Ø³Ø±ÙŠØ¹</option>
                <option value="Ø¯Ø¹Ù… ÙˆØªÙˆØ¬ÙŠÙ‡ ğŸ¤">ğŸ¤ Ø¯Ø¹Ù… ÙˆØªÙˆØ¬ÙŠÙ‡</option>
            </select>
            <button class="btn" style="background:#ec4899; margin-bottom:15px;" onclick="sendMoodOnly()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© ğŸ•Šï¸</button>

            <div id="psyChatContainer">
                <button class="clear-chat-btn" onclick="clearPsyChat()">Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ğŸ—‘ï¸</button>
                <br>
                <small style="color: #94a3b8;">Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¬Ù‡ÙˆÙ„Ø© Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…:</small>
                <div id="psyLocalChat" style="height: 100px; overflow-y: auto; background: rgba(0,0,0,0.2); border-radius: 8px; padding: 8px; font-size: 12px; margin: 5px 0;"></div>
                <div style="display: flex; gap: 5px;">
                    <input type="text" id="psyChatInput" placeholder="Ø±Ø³Ø§Ù„Ø© Ø³Ø±ÙŠØ©..." style="margin-bottom:0; font-size:12px;">
                    <button onclick="sendPsyChat()" style="background:#ec4899; border:none; padding:0 10px; border-radius:8px; color:white;">Ø¥Ø±Ø³Ø§Ù„</button>
                </div>
            </div>

            <button class="btn" style="background:#fbbf24; color:#000; margin-top:15px;" onclick="startPrayerSession()">âœ¨ ÙŠÙ„Ø§ Ù†ØµÙ„Ùˆ Ø³ÙˆØ§ (33 ØµÙ„Ø§Ø©) âœ¨</button>
            <div id="prayerTimer">
                <div class="prayer-text-display" id="activePrayer"></div>
                <div class="prayer-counter" id="pCountText">0</div>
                <button class="btn" style="background:#818cf8; height: 70px;" onclick="countPrayer()">Ø§Ø¶ØºØ· Ù„Ù„Ø¹Ø¯ â”</button>
            </div>
        </div>

        <div id="librarySection" class="section" style="border: 2px solid #10b981;">
            <h3 style="color: #10b981; margin-top:0;">ğŸ¥ Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…ÙŠØ¯ÙŠØ§</h3>
            <div class="lib-grid">
                <a id="hymnLink" href="#" target="_blank" class="lib-card">ğŸµ Ù„Ø­Ù† Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</a>
                <a id="pdfLink" href="#" target="_blank" class="lib-card">ğŸ“– Ø§Ù„Ù…Ù†Ù‡Ø¬ (PDF)</a>
                <a id="videoLink" href="#" target="_blank" class="lib-card" style="grid-column: span 2;">ğŸ¬ Ø´Ø§Ù‡Ø¯ ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¯Ø±Ø³</a>
            </div>
        </div>

        <div class="switch-container prayer-altar-switch" style="background: #334155; padding: 10px 15px; border-radius: 12px; margin-bottom: 15px; color: white;">
            <span style="font-weight: bold; color: #fbbf24;">ğŸ™ ÙØªØ­ Ù…Ø°Ø¨Ø­ Ø§Ù„ØµÙ„Ø§Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠ</span>
            <label class="switch">
                <input type="checkbox" onchange="document.getElementById('mutualPrayerSection').style.display = this.checked ? 'block' : 'none'">
                <span class="slider" style="border-color: #fbbf24;"></span>
            </label>
        </div>

        <div id="mutualPrayerSection" class="section" style="display: none; background: linear-gradient(180deg, #1e293b 0%, #2d2a5a 100%); padding: 15px; border-radius: 15px; border: 2px solid #fbbf24; margin-bottom: 20px;">
            <h3 style="color: #fbbf24; margin-top:0; text-align:center; border-bottom: 1px solid rgba(251,191,36,0.3); padding-bottom: 10px;">âœ¨ Ù…ÙØ°Ù’Ø¨ÙØ­ Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø© Ø§Ù„ÙŠÙÙˆÙ’Ù…ÙÙŠ âœ¨</h3>
            
            <div style="margin-bottom: 20px;">
                <label style="color: #fbbf24; font-weight: bold; display: block; margin-bottom: 5px;">ğŸ“– Ù¡. ØµÙ„Ø§Ø© Ù…Ù† Ø§Ù„Ø£Ø¬Ø¨ÙŠØ©:</label>
                <div id="admin_agpeya_hint" style="color: #4ade80; font-size: 13px; font-style: italic; margin-bottom: 8px; background: rgba(74, 222, 128, 0.1); padding: 5px; border-radius: 5px;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø®Ø§Ø¯Ù…...</div>
                <textarea id="agpeyaText" placeholder="Ø§ÙƒØªØ¨ Ù…Ø§ ØµÙ„ÙŠØªÙ‡ Ù‡Ù†Ø§..." style="width: 100%; height: 60px; background: #0f172a; color: white; border: 1px solid #475569; border-radius: 10px; padding: 10px; resize: none;"></textarea>
            </div>

            <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0;">

            <div style="margin-bottom: 20px;">
                <label style="color: #fbbf24; font-weight: bold; display: block; margin-bottom: 12px;">ğŸ•Šï¸ Ù¢. ØµÙ„Ø§ØªÙŠ Ø§Ù„Ø®Ø§ØµØ©:</label>
                
                <div class="metania-row">
                    <span style="color: #c7d2fe; font-size: 14px;">â€¢ Ù…ÙŠØ·Ø§Ù†ÙŠØ©:</span>
                    <input type="checkbox" id="metaniaDone"> <span style="font-size: 12px;">ØªÙ…</span>
                    <input type="number" id="metaniaCount" placeholder="Ø§Ù„Ø¹Ø¯Ø¯" min="0">
                </div>

                <div style="margin-bottom: 12px;">
                    <small style="color: #c7d2fe; display: block; margin-bottom: 3px;">â€¢ Ø´ÙƒØ±Ø§Ù‹ Ù„Ø±Ø¨Ù†Ø§ ÙŠØ³ÙˆØ¹:</small>
                    <div id="admin_thanks_hint" style="color: #4ade80; font-size: 12px; margin-bottom: 5px;"></div>
                    <textarea id="prayThank" placeholder="Ø§ÙƒØªØ¨ Ø´ÙƒØ±Ùƒ Ù‡Ù†Ø§..." style="width: 100%; height: 50px; background: #0f172a; color: white; border: 1px solid #475569; border-radius: 10px; padding: 8px; resize: none;"></textarea>
                </div>
                <div style="margin-bottom: 12px;">
                    <small style="color: #c7d2fe; display: block; margin-bottom: 3px;">â€¢ Ø®Ø¶ÙˆØ¹ ÙˆØ·Ù„Ø¨ Ù…ØºÙØ±Ø©:</small>
                    <div id="admin_forgive_hint" style="color: #4ade80; font-size: 12px; margin-bottom: 5px;"></div>
                    <textarea id="prayForgive" placeholder="Ø§ÙƒØªØ¨ ØµÙ„Ø§ØªÙƒ Ù‡Ù†Ø§..." style="width: 100%; height: 50px; background: #0f172a; color: white; border: 1px solid #475569; border-radius: 10px; padding: 8px; resize: none;"></textarea>
                </div>
                <div style="margin-bottom: 12px;">
                    <small style="color: #c7d2fe; display: block; margin-bottom: 3px;">â€¢ Ù‚Ù„Ø¨ÙŠ Ù…Ù„ØªÙ‡Ø¨ Ù„Ø±Ø¨Ù†Ø§:</small>
                    <div id="admin_heart_hint" style="color: #4ade80; font-size: 12px; margin-bottom: 5px;"></div>
                    <textarea id="prayHeart" placeholder="Ø§ÙƒØªØ¨ ØµÙ„Ø§ØªÙƒ Ù‡Ù†Ø§..." style="width: 100%; height: 50px; background: #0f172a; color: white; border: 1px solid #475569; border-radius: 10px; padding: 8px; resize: none;"></textarea>
                </div>
                <div style="margin-bottom: 12px;">
                    <small style="color: #c7d2fe; display: block; margin-bottom: 3px;">â€¢ Ø·Ù„Ø¨Ø© Ø§ØªØ­Ø§Ø¯ ÙÙŠ Ø±Ø¨Ù†Ø§:</small>
                    <div id="admin_union_hint" style="color: #4ade80; font-size: 12px; margin-bottom: 5px;"></div>
                    <textarea id="prayUnion" placeholder="Ø§ÙƒØªØ¨ ØµÙ„Ø§ØªÙƒ Ù‡Ù†Ø§..." style="width: 100%; height: 50px; background: #0f172a; color: white; border: 1px solid #475569; border-radius: 10px; padding: 8px; resize: none;"></textarea>
                </div>
            </div>

            <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0;">

            <div style="margin-bottom: 20px;">
                <label style="color: #fbbf24; font-weight: bold; display: block; margin-bottom: 5px;">ğŸ“œ Ù£. Ø£ÙƒØ«Ø± Ø¢ÙŠØ© Ù…Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ø§Ù„Ù…Ù‚Ø¯Ø³:</label>
                <div id="admin_verse_hint" style="color: #4ade80; font-size: 12px; margin-bottom: 5px;"></div>
                <textarea id="bibleVerseText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¢ÙŠØ© Ù‡Ù†Ø§..." style="width: 100%; height: 50px; background: #0f172a; color: white; border: 1px solid #475569; border-radius: 10px; padding: 8px; resize: none;"></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="color: #fbbf24; font-weight: bold; display: block; margin-bottom: 5px;">â±ï¸ Ù¤. Ù…Ø¯Ø© Ø§Ù„ØµÙ„Ø§Ø© (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚):</label>
                <input type="number" id="prayerDuration" placeholder="Ù…Ø«Ù„Ø§Ù‹: 15" style="width: 100%; background: #0f172a; color: white; border: 1px solid #fbbf24; padding: 12px; border-radius: 10px; box-sizing: border-box;">
            </div>

            <div style="text-align:center;">
                <input type="text" id="prayerUserName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ" style="width: 100%; text-align: center; margin-bottom: 10px; border: 1px solid #fbbf24; background: #0f172a; color: white; padding: 12px; border-radius: 10px; box-sizing: border-box;">
                <button class="btn" style="background: #fbbf24; color: #0f172a; width: 100%; padding: 15px; font-weight: bold; border-radius: 10px;" onclick="sendMutualPrayer()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø°Ø¨Ø­ âœ…</button>
            </div>
        </div>

        <div class="section" style="border: 2px solid #818cf8;">
            <h3 style="color: #818cf8; margin-top:0;">â“ Ø³Ø¤Ø§Ù„ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­</h3>
            <textarea id="quesMsg" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." style="height: 60px;"></textarea>
            <button class="btn" style="background:#818cf8;" onclick="sendQuestion()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

<script>
    const config = { databaseURL: "https://mariam-b85f5-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(config);
    const db = firebase.database();

    let psySessionID = localStorage.getItem('psy_session_id') || ("User_" + Date.now());
    localStorage.setItem('psy_session_id', psySessionID);

    const bibleVerses = [
        {t: "Ù„Ø§Ù ØªÙØ®ÙÙÙ’ Ù„Ø£ÙÙ†Ù‘ÙÙŠ Ù…ÙØ¹ÙÙƒÙ. Ù„Ø§Ù ØªÙØªÙÙ„ÙÙÙ‘ÙØªÙ’ Ù„Ø£ÙÙ†Ù‘ÙÙŠ Ø¥ÙÙ„Ù‡ÙÙƒÙ. Ù‚ÙØ¯Ù’ Ø£ÙÙŠÙ‘ÙØ¯Ù’ØªÙÙƒÙ ÙˆÙØ£ÙØ¹ÙÙ†Ù’ØªÙÙƒÙ ÙˆÙØ¹ÙØ¶ÙØ¯Ù’ØªÙÙƒÙ Ø¨ÙÙŠÙÙ…ÙÙŠÙ†Ù Ø¨ÙØ±Ù‘ÙÙŠ.", r: "Ø¥Ø´Ø¹ÙŠØ§Ø¡ 41: 10"},
        {t: "Ø£ÙÙ†ÙØ§ Ù…ÙØ¹ÙÙƒÙÙ…Ù’ ÙƒÙÙ„Ù‘Ù Ø§Ù„Ø£ÙÙŠÙ‘ÙØ§Ù…Ù Ø¥ÙÙ„ÙÙ‰ Ø§Ù†Ù’Ù‚ÙØ¶ÙØ§Ø¡Ù Ø§Ù„Ø¯Ù‘ÙÙ‡Ù’Ø±Ù.", r: "Ù…ØªÙ‰ 28: 20"},
        {t: "Ø§ÙÙ„Ø±Ù‘ÙØ¨Ù‘Ù Ø±ÙØ§Ø¹ÙÙŠÙ‘Ù ÙÙÙ„Ø§Ù ÙŠÙØ¹Ù’ÙˆÙØ²ÙÙ†ÙÙŠ Ø´ÙÙŠÙ’Ø¡ÙŒ.", r: "Ù…Ø²Ù…ÙˆØ± 23: 1"},
        {t: "ØªÙØ¹ÙØ§Ù„ÙÙˆÙ’Ø§ Ø¥ÙÙ„ÙÙŠÙ‘Ù ÙŠÙØ§ Ø¬ÙÙ…ÙÙŠØ¹Ù Ø§Ù„Ù’Ù…ÙØªÙ’Ø¹ÙØ¨ÙÙŠÙ†Ù ÙˆÙØ§Ù„Ø«Ù‘ÙÙ‚ÙÙŠÙ„ÙÙŠ Ø§Ù„Ø£ÙØ­Ù’Ù…ÙØ§Ù„ÙØŒ ÙˆÙØ£ÙÙ†ÙØ§ Ø£ÙØ±ÙÙŠØ­ÙÙƒÙÙ…Ù’.", r: "Ù…ØªÙ‰ 11: 28"},
        {t: "ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù Ù…ÙØ³Ù’ØªÙØ·ÙØ§Ø¹ÙŒ Ù„ÙÙ„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†Ù.", r: "Ù…Ø±Ù‚Ø³ 9: 23"},
        {t: "Ø£ÙØ³Ù’ØªÙØ·ÙÙŠØ¹Ù ÙƒÙÙ„Ù‘Ù Ø´ÙÙŠÙ’Ø¡Ù ÙÙÙŠ Ø§Ù„Ù’Ù…ÙØ³ÙÙŠØ­Ù Ø§Ù„Ù‘ÙØ°ÙÙŠ ÙŠÙÙ‚ÙÙˆÙ‘ÙÙŠÙ†ÙÙŠ.", r: "ÙÙŠÙ„Ø¨ÙŠ 4: 13"},
        {t: "Ø³ÙÙ„Ø§ÙÙ…Ù‹Ø§ Ø£ÙØªÙ’Ø±ÙÙƒÙ Ù„ÙÙƒÙÙ…Ù’. Ø³ÙÙ„Ø§ÙÙ…ÙÙŠ Ø£ÙØ¹Ù’Ø·ÙÙŠÙƒÙÙ…Ù’. Ù„ÙÙŠÙ’Ø³Ù ÙƒÙÙ…ÙØ§ ÙŠÙØ¹Ù’Ø·ÙÙŠ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…Ù Ø£ÙØ¹Ù’Ø·ÙÙŠÙƒÙÙ…Ù’ Ø£ÙÙ†ÙØ§.", r: "ÙŠÙˆØ­Ù†Ø§ 14: 27"},
        {t: "Ù…ÙÙ„Ù’Ù‚ÙÙŠÙ†Ù ÙƒÙÙ„Ù‘Ù Ù‡ÙÙ…Ù‘ÙÙƒÙÙ…Ù’ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙØŒ Ù„Ø£ÙÙ†Ù‘ÙÙ‡Ù Ù‡ÙÙˆÙ ÙŠÙØ¹Ù’ØªÙÙ†ÙÙŠ Ø¨ÙÙƒÙÙ…Ù’.", r: "1 Ø¨Ø·Ø±Ø³ 5: 7"},
        {t: "Ø¥ÙÙ†Ù’ ÙƒÙØ§Ù†Ù Ø§Ù„Ù„Ù‡Ù Ù…ÙØ¹ÙÙ†ÙØ§ØŒ ÙÙÙ…ÙÙ†Ù’ Ø¹ÙÙ„ÙÙŠÙ’Ù†ÙØ§ØŸ", r: "Ø±ÙˆÙ…ÙŠØ© 8: 31"},
        {t: "ÙŠÙØ¹Ù’Ø·ÙÙŠ Ø§Ù„Ù’Ù…ÙØ¹Ù’ÙŠÙÙŠÙ Ù‚ÙØ¯Ù’Ø±ÙØ©Ù‹ØŒ ÙˆÙÙ„ÙØ¹ÙØ¯ÙÙŠÙ…Ù Ø§Ù„Ù’Ù‚ÙÙˆÙ‘ÙØ©Ù ÙŠÙÙƒÙØ«Ù‘ÙØ±Ù Ø´ÙØ¯Ù‘ÙØ©Ù‹.", r: "Ø¥Ø´Ø¹ÙŠØ§Ø¡ 40: 29"},
        {t: "Ø§ÙÙ„Ø±Ù‘ÙØ¨Ù‘Ù Ù†ÙÙˆØ±ÙÙŠ ÙˆÙØ®ÙÙ„Ø§ÙØµÙÙŠØŒ Ù…ÙÙ…Ù‘ÙÙ†Ù’ Ø£ÙØ®ÙØ§ÙÙØŸ Ø§ÙÙ„Ø±Ù‘ÙØ¨Ù‘Ù Ø­ÙØµÙ’Ù†Ù Ø­ÙÙŠÙØ§ØªÙÙŠØŒ Ù…ÙÙ…Ù‘ÙÙ†Ù’ Ø£ÙØ±Ù’ØªÙØ¹ÙØ¨ÙØŸ", r: "Ù…Ø²Ù…ÙˆØ± 27: 1"},
        {t: "Ù„Ø£ÙÙ†Ù‘Ù Ù…ÙÙ„Ø§ÙØ¦ÙÙƒÙØªÙÙ‡Ù ÙŠÙÙˆØµÙÙŠÙ‡Ù Ø¨ÙÙƒÙ Ù„ÙÙƒÙÙŠÙ’ ÙŠÙØ­Ù’ÙÙØ¸ÙÙˆÙƒÙ ÙÙÙŠ ÙƒÙÙ„Ù‘Ù Ø·ÙØ±ÙÙ‚ÙÙƒÙ.", r: "Ù…Ø²Ù…ÙˆØ± 91: 11"},
        {t: "Ø§Ù„Ø±Ù‘ÙØ¨Ù‘Ù ÙŠÙØ­ÙØ§Ø±ÙØ¨Ù Ø¹ÙÙ†Ù’ÙƒÙÙ…Ù’ ÙˆÙØ£ÙÙ†Ù’ØªÙÙ…Ù’ ØªÙØµÙ’Ù…ÙØªÙÙˆÙ†Ù.", r: "Ø®Ø±ÙˆØ¬ 14: 14"},
        {t: "Ù…ÙØ­ÙØ¨Ù‘ÙØ©Ù‹ Ø£ÙØ¨ÙØ¯ÙÙŠÙ‘ÙØ©Ù‹ Ø£ÙØ­Ù’Ø¨ÙØ¨Ù’ØªÙÙƒÙØŒ Ù…ÙÙ†Ù’ Ø£ÙØ¬Ù’Ù„Ù Ø°Ù„ÙÙƒÙ Ø£ÙØ¯ÙÙ…Ù’ØªÙ Ù„ÙÙƒÙ Ø§Ù„Ø±Ù‘ÙØ­Ù’Ù…ÙØ©Ù.", r: "Ø¥Ø±Ù…ÙŠØ§ 31: 3"},
        {t: "ÙÙÙŠ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…Ù Ø³ÙÙŠÙÙƒÙÙˆÙ†Ù Ù„ÙÙƒÙÙ…Ù’ Ø¶ÙÙŠÙ‚ÙŒØŒ ÙˆÙÙ„ÙƒÙÙ†Ù’ Ø«ÙÙ‚ÙÙˆØ§: Ø£ÙÙ†ÙØ§ Ù‚ÙØ¯Ù’ ØºÙÙ„ÙØ¨Ù’ØªÙ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…Ù.", r: "ÙŠÙˆØ­Ù†Ø§ 16: 33"},
        {t: "Ù†ÙØ­Ù’Ù†Ù Ù†ÙØ¹Ù’Ù„ÙÙ…Ù Ø£ÙÙ†Ù‘Ù ÙƒÙÙ„Ù‘Ù Ø§Ù„Ø£ÙØ´Ù’ÙŠÙØ§Ø¡Ù ØªÙØ¹Ù’Ù…ÙÙ„Ù Ù…ÙØ¹Ù‹Ø§ Ù„ÙÙ„Ù’Ø®ÙÙŠÙ’Ø±Ù Ù„ÙÙ„Ù‘ÙØ°ÙÙŠÙ†Ù ÙŠÙØ­ÙØ¨Ù‘ÙÙˆÙ†Ù Ø§Ù„Ù„Ù‡Ù.", r: "Ø±ÙˆÙ…ÙŠØ© 8: 28"},
        {t: "Ù‚ÙØ±ÙÙŠØ¨ÙŒ Ù‡ÙÙˆÙ Ø§Ù„Ø±Ù‘ÙØ¨Ù‘Ù Ù…ÙÙ†Ù Ø§Ù„Ù’Ù…ÙÙ†Ù’ÙƒÙØ³ÙØ±ÙÙŠ Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù.", r: "Ù…Ø²Ù…ÙˆØ± 34: 18"},
        {t: "Ø§ÙØªÙ‘ÙÙƒÙÙ„Ù’ Ø¹ÙÙ„ÙÙ‰ Ø§Ù„Ø±Ù‘ÙØ¨Ù‘Ù Ø¨ÙÙƒÙÙ„Ù‘Ù Ù‚ÙÙ„Ù’Ø¨ÙÙƒÙØŒ ÙˆÙØ¹ÙÙ„ÙÙ‰ ÙÙÙ‡Ù’Ù…ÙÙƒÙ Ù„Ø§Ù ØªÙØ¹Ù’ØªÙÙ…ÙØ¯Ù’.", r: "Ø£Ù…Ø«Ø§Ù„ 3: 5"},
        {t: "Ù‡Ø£ÙÙ†ÙØ°ÙØ§ Ù‚ÙØ¯Ù’ Ù†ÙÙ‚ÙØ´Ù’ØªÙÙƒÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙÙ‘ÙÙŠÙ‘Ù. Ø£ÙØ³Ù’ÙˆÙØ§Ø±ÙÙƒÙ Ø£ÙÙ…ÙØ§Ù…ÙÙŠ Ø¯ÙØ§Ø¦ÙÙ…Ù‹Ø§.", r: "Ø¥Ø´Ø¹ÙŠØ§Ø¡ 49: 16"},
        {t: "Ø³ÙØ±ÙØ§Ø¬ÙŒ Ù„ÙØ±ÙØ¬Ù’Ù„ÙÙŠ ÙƒÙÙ„Ø§ÙÙ…ÙÙƒÙ ÙˆÙÙ†ÙÙˆØ±ÙŒ Ù„ÙØ³ÙØ¨ÙÙŠÙ„ÙÙŠ.", r: "Ù…Ø²Ù…ÙˆØ± 119: 105"}
    ];

    const prayers = [
        "ÙŠØ§Ø±Ø¨ ÙŠØ³ÙˆØ¹ Ø§Ù„Ù…Ø³ÙŠØ­.. Ø§Ø±Ø­Ù…Ù†ÙŠ Ø£Ù†Ø§ Ø§Ù„Ø®Ø§Ø·Ø¦",
        "ÙŠØ§ Ø±Ø¨ÙŠ ÙŠØ³ÙˆØ¹ Ø§Ù„Ù…Ø³ÙŠØ­.. Ø£Ø¹Ù†Ù‘ÙŠ",
        "ÙŠØ§ Ø±Ø¨ÙŠ ÙŠØ³ÙˆØ¹ Ø§Ù„Ù…Ø³ÙŠØ­.. Ø§Ø³ØªØ± Ø¹Ù„ÙŠÙ‘",
        "ÙŠØ§ Ø±Ø¨ÙŠ ÙŠØ³ÙˆØ¹ Ø§Ù„Ù…Ø³ÙŠØ­.. Ø£Ù†Ù‚Ø°Ù†ÙŠ",
        "ÙŠØ§ Ø±Ø¨ÙŠ ÙŠØ³ÙˆØ¹ Ø§Ù„Ù…Ø³ÙŠØ­.. Ø§Ù…Ù„Ø£ Ù‚Ù„Ø¨ÙŠ Ø¨Ø­Ø¨Ùƒ"
    ];

    let currentMood = "ğŸ˜Œ";
    let pCount = 0;
    let quizTimerInterval;
    let allQuizQuestions = [];
    let selectedQuizStudentName = "";

    function toggleTheme() {
        const body = document.body;
        const btn = document.getElementById('themeBtn');
        if (body.getAttribute('data-theme') === 'light') {
            body.setAttribute('data-theme', 'dark');
            btn.innerText = "â˜€ï¸ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­";
        } else {
            body.setAttribute('data-theme', 'light');
            btn.innerText = "ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†";
        }
    }

    function checkSavedAccess() {
        const lastLogin = localStorage.getItem('lastLoginTime');
        const dayInMs = 24 * 60 * 60 * 1000;
        if (lastLogin && (Date.now() - lastLogin < dayInMs)) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            startApp();
            showRandomVerse();
        }
    }

    function checkAccess() {
        if(document.getElementById('passInputUser').value === "jesus") {
            localStorage.setItem('lastLoginTime', Date.now());
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            startApp();
            showRandomVerse();
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        } else { alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø·Ø£!"); }
    }

    function showRandomVerse() {
        const v = bibleVerses[Math.floor(Math.random() * bibleVerses.length)];
        document.getElementById('dailyVerse').innerText = `"${v.t}"`;
        document.getElementById('verseRef').innerText = `(${v.r})`;
    }

    function startApp() {
        if(localStorage.getItem('chat_user_name')) document.getElementById('userName').value = localStorage.getItem('chat_user_name');
        
        db.ref("admin_announcement").on("value", snap => {
            const text = snap.val();
            document.getElementById('adminAlert').style.display = (text && text.trim() !== "") ? 'block' : 'none';
            document.getElementById('alertText').innerText = text;
        });

        db.ref("settings/quizEnabled").on("value", snap => {
            document.getElementById('quizSection').style.display = snap.val() === true ? "block" : "none";
        });

        db.ref("settings/libVisible").on("value", snap => {
            document.getElementById('librarySection').style.display = snap.val() !== false ? "block" : "none";
        });

        db.ref("media_library").on("value", snap => {
            const d = snap.val();
            if(d) {
                document.getElementById('hymnLink').href = d.hymn || "#";
                document.getElementById('pdfLink').href = d.pdf || "#";
                document.getElementById('videoLink').href = d.video || "#";
            }
        });

        listenToAdminPrayers();

        db.ref("points_data").on("value", snap => {
            const select = document.getElementById('userNameListQuiz');
            const list = document.getElementById('leaderboard'); 
            const currentSel = select.value;
            select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ --</option>';
            list.innerHTML = "";
            const data = snap.val(); if(!data) return;
            Object.values(data).forEach(p => { select.innerHTML += `<option value="${p.name}">${p.name}</option>`; });
            if(currentSel) select.value = currentSel;
            Object.values(data).sort((a,b) => b.score - a.score).forEach(p => {
                let clr = p.score >= 70 ? 'bg-high' : (p.score >= 40 ? 'bg-mid' : 'bg-low');
                list.innerHTML += `<div class="card"><div class="bar-wrap"><div class="bar ${clr}" style="height:${Math.min(p.score, 100)}%"></div></div><div style="font-weight:bold; color:#fbbf24;">${p.score}</div><div style="font-size:11px;">${p.name}</div></div>`;
            });
        });

        db.ref("chat").limitToLast(15).on("value", snap => {
            const box = document.getElementById('chatBox'); box.innerHTML = "";
            snap.forEach(c => { 
                const msg = c.val();
                const style = (msg.sender.includes("Ø£/") || msg.sender.includes("Ø£Ù…ÙŠÙ†")) ? "background: #422006; border-right: 3px solid #fbbf24;" : "";
                box.innerHTML += `<div class="chat-msg" style="${style}"><b>${msg.sender}:</b> ${msg.text}</div>`; 
            });
            box.scrollTop = box.scrollHeight;
        });

        db.ref("psychology/private_chats/" + psySessionID).on("value", snap => {
            const box = document.getElementById('psyLocalChat'); box.innerHTML = "";
            snap.forEach(m => {
                const msg = m.val();
                box.innerHTML += `<div style="margin-bottom:4px; color:${msg.sender === "Ø£Ù†Ø§" ? "#ec4899" : "#fbbf24"};"><b>${msg.sender}:</b> ${msg.text}</div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }

    function listenToAdminPrayers() {
        db.ref("admin_prayer_hints").on("value", (snapshot) => {
            const data = snapshot.val() || {};
            document.getElementById('admin_agpeya_hint').innerText = data.agpeya || "ØµÙ„Ù‘Ù Ù…Ø²Ù…ÙˆØ±Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ø¬Ø¨ÙŠØ©..";
            document.getElementById('admin_thanks_hint').innerText = data.thanks || "Ø§Ø´ÙƒØ± Ø§Ù„Ù„Ù‡ Ø¹Ù„Ù‰ ÙƒÙ„ Ø­Ø§Ù„..";
            document.getElementById('admin_forgive_hint').innerText = data.forgive || "Ø§Ø·Ù„Ø¨ ØªÙˆØ¨Ø© Ù†Ù‚ÙŠØ©..";
            document.getElementById('admin_heart_hint').innerText = data.heart || "Ø§Ø¬Ø¹Ù„ Ù‚Ù„Ø¨Ùƒ ÙŠØ´ØªØ¹Ù„ Ø¨Ø­Ø¨ Ø§Ù„Ù…Ø³ÙŠØ­..";
            document.getElementById('admin_union_hint').innerText = data.union || "Ø§Ø·Ù„Ø¨ Ø£Ù† ØªÙƒÙˆÙ† ÙˆØ§Ø­Ø¯Ø§Ù‹ Ù…Ø¹Ù‡..";
            document.getElementById('admin_verse_hint').innerText = data.verse || "Ø´Ø§Ø±ÙƒÙ†Ø§ Ø¢ÙŠØ© Ù„Ù…Ø³ØªÙƒ Ø§Ù„ÙŠÙˆÙ…..";
        });
    }

    function sendMutualPrayer() {
        const name = document.getElementById('prayerUserName').value.trim();
        const durationValue = document.getElementById('prayerDuration').value.trim();
        
        if(!name) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ â¤ï¸");
        if(!durationValue) return alert("Ø¨Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…Ø¯Ø© Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ â±ï¸");

        const report = {
            makhdom: name,
            time: new Date().toLocaleString(),
            duration: durationValue + " Ø¯Ù‚ÙŠÙ‚Ø©",
            metania: {
                done: document.getElementById('metaniaDone').checked,
                count: document.getElementById('metaniaCount').value || 0
            },
            agpeya: document.getElementById('agpeyaText').value,
            thanks: document.getElementById('prayThank').value,
            forgive: document.getElementById('prayForgive').value,
            heart: document.getElementById('prayHeart').value,
            union: document.getElementById('prayUnion').value,
            verse: document.getElementById('bibleVerseText').value
        };

        db.ref("prayer_reports").push(report).then(() => {
            alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­ ÙŠØ§ " + name);
            document.querySelectorAll('#mutualPrayerSection textarea, #mutualPrayerSection input:not([type="checkbox"])').forEach(el => el.value = "");
            document.getElementById('metaniaDone').checked = false;
            confetti({ particleCount: 100, spread: 50, origin: { y: 0.8 } });
        });
    }

    function startQuiz() {
        selectedQuizStudentName = document.getElementById('userNameListQuiz').value;
        if(!selectedQuizStudentName) return alert("Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ø£ÙˆÙ„Ø§Ù‹");
        const boundName = localStorage.getItem('quiz_bound_name');
        if (boundName && boundName !== selectedQuizStudentName) {
            alert(`Ù‡Ø°Ø§ Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ø³Ø¬Ù„ Ø¨Ø§Ø³Ù… (${boundName}). Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø­Ù„ Ù„Ø²Ù…ÙŠÙ„ Ø¢Ø®Ø±!`);
            return;
        }
        db.ref("bible_quiz/submissions").orderByChild("userName").equalTo(selectedQuizStudentName).once("value", snap => {
            if(snap.exists()) {
                alert("Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø­Ù„ Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹!");
                localStorage.setItem('quiz_bound_name', selectedQuizStudentName);
                showFinishedStatus();
            } else {
                localStorage.setItem('quiz_bound_name', selectedQuizStudentName);
                loadQuiz();
            }
        });
    }

    function loadQuiz() {
        db.ref("settings/quizTimer").once("value", snapTime => {
            let timerMinutes = snapTime.val() || 5;
            let durationInSeconds = timerMinutes * 60;
            db.ref("bible_quiz/questions").once("value", snapQ => {
                const container = document.getElementById('questionsContainer');
                container.innerHTML = ""; allQuizQuestions = []; let i = 0;
                if(!snapQ.exists()) { alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹!"); return; }
                snapQ.forEach(child => {
                    const q = child.val(); allQuizQuestions.push({...q, id: child.key});
                    let html = `<div class="question-card"><p><b>Ø³${i+1}: ${q.text}</b> <small>(${q.points||1} Ø¯Ø±Ø¬Ø©)</small></p>`;
                    if (q.type === 'choice' || q.type === 'truefalse') {
                        let opts = q.options || [];
                        opts.forEach(opt => { if(opt) html += `<label class="option-label"><input type="radio" name="quiz_q_${i}" value="${opt}"> ${opt}</label>`; });
                    } else { html += `<input type="text" id="quiz_ans_${i}" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©...">`; }
                    container.innerHTML += html + `</div>`; i++;
                });
                document.getElementById('quizSetup').style.display = 'none';
                document.getElementById('quizArea').style.display = 'block';
                startCountdown(durationInSeconds);
            });
        });
    }

    function startCountdown(duration) {
        let secondsLeft = duration;
        clearInterval(quizTimerInterval);
        quizTimerInterval = setInterval(() => {
            let mins = Math.floor(secondsLeft / 60);
            let secs = secondsLeft % 60;
            document.getElementById('timeLeft').innerText = (mins<10?"0":"")+mins+":"+(secs<10?"0":"")+secs;
            if (secondsLeft <= 0) {
                clearInterval(quizTimerInterval);
                alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©! Ø³ÙŠØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.");
                submitQuiz();
            }
            secondsLeft--;
        }, 1000);
    }

    async function submitQuiz() {
        clearInterval(quizTimerInterval);
        let total = 0; let max = 0;
        allQuizQuestions.forEach((q, idx) => {
            let ans = ""; max += parseInt(q.points || 1);
            if (q.type === 'choice' || q.type === 'truefalse') {
                const sel = document.querySelector(`input[name="quiz_q_${idx}"]:checked`);
                ans = sel ? sel.value : "";
            } else { ans = document.getElementById(`quiz_ans_${idx}`).value; }
            if (ans.trim().toLowerCase() === q.correctAnswer.trim().toLowerCase()) total += parseInt(q.points || 1);
        });
        await db.ref("bible_quiz/submissions").push({ 
            userName: selectedQuizStudentName, 
            score: total, 
            max: max, 
            time: new Date().toLocaleString('ar-EG'),
            deviceId: psySessionID 
        });
        db.ref("points_data").once("value", snap => {
            snap.forEach(child => { if (child.val().name === selectedQuizStudentName) child.ref.update({ score: (child.val().score || 0) + total }); });
        });
        showFinishedStatus(total, max);
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
    }

    function showFinishedStatus(score, max) {
        document.getElementById('quizSetup').style.display = 'none';
        document.getElementById('quizArea').style.display = 'none';
        document.getElementById('quizDone').style.display = 'block';
        if (score !== undefined) document.getElementById('finalQuizScore').innerText = `Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${score} Ù…Ù† ${max}`;
    }

    function sendChat() {
        const inp = document.getElementById('chatInput'); const name = document.getElementById('userName').value || "Ù…Ø®Ø¯ÙˆÙ…";
        if(inp.value.trim()) { db.ref("chat").push({sender: name, text: inp.value}); inp.value = ""; }
    }

    function setMood(el, m) {
        document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active'); currentMood = m;
    }

    function sendMoodOnly() {
        db.ref("psychology/confessions").push({
            sender: document.getElementById('psyNameInput').value || "Ø§Ø¨Ù† Ø§Ù„Ø·Ø§Ø¹Ø©",
            mood: currentMood, need: document.getElementById('psyNeed').value,
            text: "ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© ÙÙ‚Ø·", time: new Date().toLocaleString()
        });
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ â¤ï¸");
    }

    function sendPsyChat() {
        const inp = document.getElementById('psyChatInput');
        if(inp.value.trim()) {
            db.ref("psychology/private_chats/" + psySessionID).push({ sender: "Ø£Ù†Ø§", text: inp.value.trim() });
            inp.value = "";
        }
    }

    function clearPsyChat() {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø³Ø¬Ù„ Ù…Ø­Ø§Ø¯Ø«ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) {
            db.ref("psychology/private_chats/" + psySessionID).remove()
            .then(() => { alert("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…"); });
        }
    }

    function startPrayerSession() {
        document.getElementById('prayerTimer').style.display = 'block';
        pCount = 0; updatePrayerDisplay();
    }

    function countPrayer() {
        pCount++; updatePrayerDisplay();
        if(window.navigator.vibrate) window.navigator.vibrate(40);
        if(pCount >= 33) { alert("ØµÙ„Ø§Ø© Ù…Ù‚Ø¨ÙˆÙ„Ø©! Ø£ØªÙ…Ù…Øª Ø§Ù„Ù€ 33 ØµÙ„Ø§Ø© âœ¨"); document.getElementById('prayerTimer').style.display = 'none'; }
    }

    function updatePrayerDisplay() {
        document.getElementById('pCountText').innerText = pCount;
        document.getElementById('activePrayer').innerText = prayers[pCount % prayers.length];
    }

    function sendQuestion() {
        const txt = document.getElementById('quesMsg').value.trim();
        if(txt) {
            db.ref("psychology/questions").push({ sender: "Ù…Ø®Ø¯ÙˆÙ…", text: txt, time: new Date().toLocaleString() });
            alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!"); document.getElementById('quesMsg').value = "";
        }
    }

    window.onload = checkSavedAccess;
</script>
</body>
</html>
